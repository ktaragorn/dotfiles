# sshuttle helpers

# set default SSH server:
#   user@hostname or a host in ~/.ssh/config
SSH_SERVER=default_ssh

# sshuttle for all traffic, including DNS.
alias vpn='sshuttle --dns -vr $SSH_SERVER 0/0'

# returns a list of IP addresses from given domain(s).
#
# Examples:
#  dns2ip google.com
#  dns2ip netflix.com movies.netflix.com
#
function dns2ip() {
  dig +short $* | sed "/[^0-9\.]/d" # use sed to remove non-IPv4 line e.g. alias
}

# sshuttle for the specified domain(s) only.
#
# Examples:
#  vpnfor google.com
#  vpnfor netflix.com movies.netflix.com
#
function vpnfor() { 
  sshuttle -vr $SSH_SERVER `dns2ip $*`;
}

# sshuttle for all traffic including DNS, except the specified domain(s).
#
# Examples:
#  vpnbut youku.com
#  vpnbut youku.com weibo.com
#
function vpnbut() { 
  sshuttle --dns -vr $SSH_SERVER `dns2ip $* | sed "s/^/-x/"` 0/0; # use sed to append '-x' prefix 
}

